{"version":3,"sources":["webpack:///./src/sandbox/eval/transpilers/vue/v2/style-compiler/plugins/trim.js","webpack:///./src/sandbox/eval/transpilers/vue/v2/style-compiler/plugins/scope-id.js","webpack:///./src/sandbox/eval/transpilers/vue/v2/style-compiler/loader.ts","webpack:///./src/sandbox/eval/utils/is-dependency-path.ts"],"names":["postcss","require","plugin","opts","css","walk","node","type","raws","before","after","selectorParser","root","keyframes","Object","create","each","rewriteSelector","selector","selectors","n","value","spaces","next","remove","insertAfter","attribute","id","process","result","name","params","keys","length","walkDecls","decl","test","prop","split","map","v","trim","join","vals","concat","slice","resolveCSSFile","_x","_x2","_x3","_resolveCSSFile","apply","arguments","_asyncToGenerator","loaderContext","path","basePath","isDependencyPath","pkgJson","resolveTranspiledModuleAsync","parsedPkg","JSON","parse","module","code","style","fullPath","e","charAt","_x4","_x5","_ref","query","options","vueOptions","__vueOptions__","_objectSpread","vue","plugins","postcssImportPlugin","resolve","_ref2","replace","_x6","_x7","load","_ref3","filename","_x8","to","from","scoped","push","scopeId","sourceMap","cssSourceMap","inline","annotation","postcssResult","messages","Promise","all","m","addDependency","file","toJSON","transpiledCode","p"],"mappings":"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","file":"static/js/vue-style-compiler.f0f11a7be.chunk.js","sourcesContent":["/* eslint-disable */\nconst postcss = require('postcss');\n\n// eslint-disable-next-line no-unused-vars\nexport default postcss.plugin('trim', function(opts) {\n  return function(css) {\n    css.walk(function(node) {\n      if (node.type === 'rule' || node.type === 'atrule') {\n        node.raws.before = node.raws.after = '\\n';\n      }\n    });\n  };\n});\n","/* eslint-disable */\nvar postcss = require('postcss');\nvar selectorParser = require('postcss-selector-parser');\n\nexport default postcss.plugin('add-id', function(opts) {\n  return function(root) {\n    var keyframes = Object.create(null);\n\n    root.each(function rewriteSelector(node) {\n      if (!node.selector) {\n        // handle media queries\n        if (node.type === 'atrule') {\n          if (node.name === 'media') {\n            node.each(rewriteSelector);\n          } else if (node.name === 'keyframes') {\n            // register keyframes\n            keyframes[node.params] = node.params = node.params + '-' + opts.id;\n          }\n        }\n        return;\n      }\n      node.selector = selectorParser(function(selectors) {\n        selectors.each(function(selector) {\n          var node = null;\n          selector.each(function(n) {\n            // \">>>\" combinator\n            if (n.type === 'combinator' && n.value === '>>>') {\n              n.value = ' ';\n              n.spaces.before = n.spaces.after = '';\n              return false;\n            }\n            // /deep/ alias for >>>, since >>> doesn't work in SASS\n            if (n.type === 'tag' && n.value === '/deep/') {\n              var next = n.next();\n              if (next.type === 'combinator' && next.value === ' ') {\n                next.remove();\n              }\n              n.remove();\n              return false;\n            }\n            if (n.type !== 'pseudo' && n.type !== 'combinator') {\n              node = n;\n            }\n          });\n          selector.insertAfter(\n            node,\n            selectorParser.attribute({\n              attribute: opts.id,\n            })\n          );\n        });\n      }).process(node.selector).result;\n    });\n\n    // If keyframes are found in this <style>, find and rewrite animation names\n    // in declarations.\n    // Caveat: this only works for keyframes and animation rules in the same\n    // <style> element.\n    if (Object.keys(keyframes).length) {\n      root.walkDecls(decl => {\n        // individual animation-name declaration\n        if (/-?animation-name$/.test(decl.prop)) {\n          decl.value = decl.value\n            .split(',')\n            .map(v => keyframes[v.trim()] || v.trim())\n            .join(',');\n        }\n        // shorthand\n        if (/-?animation$/.test(decl.prop)) {\n          decl.value = decl.value\n            .split(',')\n            .map(v => {\n              var vals = v.split(/\\s+/);\n              var name = vals[0];\n              if (keyframes[name]) {\n                return [keyframes[name]].concat(vals.slice(1)).join(' ');\n              } else {\n                return v;\n              }\n            })\n            .join(',');\n        }\n      });\n    }\n  };\n});\n","import postcss, { ProcessOptions } from 'postcss';\nimport postcssImportPlugin from 'postcss-import';\nimport { join } from 'path';\nimport { isDependencyPath } from 'sandbox/eval/utils/is-dependency-path';\nimport { TranspiledModule } from 'sandpack-core';\nimport { LoaderContext } from 'sandpack-core/lib/transpiled-module';\n\nimport trim from './plugins/trim';\nimport scopeId from './plugins/scope-id';\n\nasync function resolveCSSFile(\n  loaderContext: LoaderContext,\n  path: string,\n  basePath: string\n): Promise<TranspiledModule> {\n  const isDependency = isDependencyPath(path);\n\n  if (isDependency) {\n    // First try to resolve the package.json, in case it has a style field\n    try {\n      const pkgJson = await loaderContext.resolveTranspiledModuleAsync(\n        join(path, 'package.json')\n      );\n      const parsedPkg = JSON.parse(pkgJson.module.code);\n\n      if (parsedPkg.style) {\n        const fullPath = join(path, parsedPkg.style);\n\n        return loaderContext.resolveTranspiledModuleAsync(fullPath);\n      }\n    } catch (e) {\n      /* Move to step 2 */\n    }\n\n    return loaderContext.resolveTranspiledModuleAsync(path);\n  }\n\n  const fullPath = path.charAt(0) === '/' ? path : join(basePath, path);\n  return loaderContext.resolveTranspiledModuleAsync(fullPath);\n}\n\nexport default async function (\n  code: string,\n  loaderContext: LoaderContext\n): Promise<{ transpiledCode: string; sourceMap: any }> {\n  const query = loaderContext.options;\n\n  let vueOptions = loaderContext.options.__vueOptions__;\n\n  if (!vueOptions) {\n    vueOptions = {\n      ...loaderContext.options.vue,\n    };\n  }\n\n  // TODO autoprefixer\n  const plugins = [\n    postcssImportPlugin({\n      resolve: async (id: string, root: string) => {\n        try {\n          const result = await resolveCSSFile(\n            loaderContext,\n            id.replace(/^~/, ''),\n            root\n          );\n\n          return result.module.path;\n        } catch (e) {\n          return null;\n        }\n      },\n      load: async (filename: string) => {\n        const tModule = await loaderContext.resolveTranspiledModuleAsync(\n          filename\n        );\n\n        return tModule.module.code;\n      },\n    }),\n    trim,\n  ];\n\n  const options: ProcessOptions = {\n    to: loaderContext.path,\n    from: loaderContext.path,\n  };\n\n  // add plugin for vue-loader scoped css rewrite\n  if (query.scoped) {\n    plugins.push(scopeId({ id: query.id }));\n  }\n\n  // source map\n  if (\n    loaderContext.sourceMap &&\n    vueOptions.cssSourceMap !== false\n    // !loaderContext.map\n  ) {\n    options.map = {\n      inline: false,\n      annotation: false,\n      // prev: loaderContext.map,\n    };\n  }\n\n  // Explicitly give undefined if code is null, otherwise postcss crashses\n  const postcssResult = await postcss(plugins).process(code || '', options);\n\n  if (postcssResult.messages) {\n    const messages = postcssResult.messages as any[];\n    await Promise.all(\n      messages.map(m => {\n        if (m.type === 'dependency') {\n          return loaderContext.addDependency(m.file);\n        }\n        return Promise.resolve();\n      })\n    );\n  }\n\n  const map = postcssResult.map && postcssResult.map.toJSON();\n  return { transpiledCode: postcssResult.css, sourceMap: map };\n}\n","export const isDependencyPath = (p: string) => /^(\\w|@\\w|@-)/.test(p);\n"],"sourceRoot":""}