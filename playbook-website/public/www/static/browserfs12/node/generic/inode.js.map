{"version":3,"file":"inode.js","sourceRoot":"","sources":["../../../src/generic/inode.ts"],"names":[],"mappings":"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","sourcesContent":["import {default as Stats, FileType} from '../core/node_fs_stats';\n\n/**\n * Generic inode definition that can easily be serialized.\n */\nexport default class Inode {\n  /**\n   * Converts the buffer into an Inode.\n   */\n  public static fromBuffer(buffer: Buffer): Inode {\n    if (buffer === undefined) {\n      throw new Error(\"NO\");\n    }\n    return new Inode(buffer.toString('ascii', 30),\n      buffer.readUInt32LE(0),\n      buffer.readUInt16LE(4),\n      buffer.readDoubleLE(6),\n      buffer.readDoubleLE(14),\n      buffer.readDoubleLE(22)\n    );\n  }\n\n  constructor(public id: string,\n              public size: number,\n              public mode: number,\n              public atime: number,\n              public mtime: number,\n              public ctime: number) { }\n\n  /**\n   * Handy function that converts the Inode to a Node Stats object.\n   */\n  public toStats(): Stats {\n    return new Stats(\n      (this.mode & 0xF000) === FileType.DIRECTORY ? FileType.DIRECTORY : FileType.FILE,\n      this.size, this.mode, this.atime, this.mtime, this.ctime);\n  }\n\n  /**\n   * Get the size of this Inode, in bytes.\n   */\n  public getSize(): number {\n    // ASSUMPTION: ID is ASCII (1 byte per char).\n    return 30 + this.id.length;\n  }\n\n  /**\n   * Writes the inode into the start of the buffer.\n   */\n  public toBuffer(buff: Buffer = Buffer.alloc(this.getSize())): Buffer {\n    buff.writeUInt32LE(this.size, 0);\n    buff.writeUInt16LE(this.mode, 4);\n    buff.writeDoubleLE(this.atime, 6);\n    buff.writeDoubleLE(this.mtime, 14);\n    buff.writeDoubleLE(this.ctime, 22);\n    buff.write(this.id, 30, this.id.length, 'ascii');\n    return buff;\n  }\n\n  /**\n   * Updates the Inode using information from the stats object. Used by file\n   * systems at sync time, e.g.:\n   * - Program opens file and gets a File object.\n   * - Program mutates file. File object is responsible for maintaining\n   *   metadata changes locally -- typically in a Stats object.\n   * - Program closes file. File object's metadata changes are synced with the\n   *   file system.\n   * @return True if any changes have occurred.\n   */\n  public update(stats: Stats): boolean {\n    let hasChanged = false;\n    if (this.size !== stats.size) {\n      this.size = stats.size;\n      hasChanged = true;\n    }\n\n    if (this.mode !== stats.mode) {\n      this.mode = stats.mode;\n      hasChanged = true;\n    }\n\n    const atimeMs = stats.atime.getTime();\n    if (this.atime !== atimeMs) {\n      this.atime = atimeMs;\n      hasChanged = true;\n    }\n\n    const mtimeMs = stats.mtime.getTime();\n    if (this.mtime !== mtimeMs) {\n      this.mtime = mtimeMs;\n      hasChanged = true;\n    }\n\n    const ctimeMs = stats.ctime.getTime();\n    if (this.ctime !== ctimeMs) {\n      this.ctime = ctimeMs;\n      hasChanged = true;\n    }\n\n    return hasChanged;\n  }\n\n  // XXX: Copied from Stats. Should reconcile these two into something more\n  //      compact.\n\n  /**\n   * @return [Boolean] True if this item is a file.\n   */\n  public isFile(): boolean {\n    return (this.mode & 0xF000) === FileType.FILE;\n  }\n\n  /**\n   * @return [Boolean] True if this item is a directory.\n   */\n  public isDirectory(): boolean {\n    return (this.mode & 0xF000) === FileType.DIRECTORY;\n  }\n}\n"]}