upstream web {
  server web:3000;
}

upstream webpacker {
  server webpacker:3035;
}

server {
  listen 3000;

  # Route traffic by default over to the rails app.
  location / {
    proxy_pass http://web;
  }

  # Route websocket traffic over to webpack dev server.
  location /sockjs-node {
    proxy_pass http://webpacker;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
  }

  # Route pack asset requests over to the webpack dev server.
  location /packs {
    proxy_pass http://webpacker;
  }
}
