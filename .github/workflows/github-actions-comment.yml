name: Update File with Current Time

on: [push]

jobs:
  update-file:
    runs-on: ubuntu-latest 
    steps:
      - name: Get Commit Info and Find Pull Request for Comment
        uses: actions/github-script@v6
        env:
          AENV: 'thisisenvvar' 
          AENVTWO: 'thisanotherisenvvar' 
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const commitSha = context.payload.head_commit.id;
            const commitMessage = context.payload.head_commit.message;
            const commitAuthor = context.payload.head_commit.author.name;
            const commitUrl = context.payload.head_commit.url;

            console.log(`Commit message: ${commitMessage}`);
            console.log(`Commit author: ${commitAuthor}`);
            console.log(`Commit URL: ${commitUrl}`);

            // Get the PR related to this commit using octokit API
            const pullRequests = await github.rest.repos.listPullRequestsAssociatedWithCommit({
              owner: context.repo.owner,
              repo: context.repo.repo,
              commit_sha: commitSha
            });

            if (pullRequests.data.length > 0) {
              const pullRequestNumber = pullRequests.data[0].number;
              console.log(`Found pull request #${pullRequestNumber} for commit ${commitSha}`);

              // Add a comment to the pull request
              await github.rest.issues.createComment({
                issue_number: pullRequestNumber,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `You merged this this pr to master branch: 
                - Ruby Gem: ${{env.AENV}}
                - NPM: ${{env.AENVTWO}}`
              });
            } else {
              console.log('No pull request found for this commit.');
            }
