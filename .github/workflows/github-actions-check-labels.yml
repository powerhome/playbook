name: Check Labels
run-name: ${{ github.actor }} is checking labels ðŸš€
on:
  pull_request:
    types: [ labeled ]
jobs:
  Checking-Labels:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./playbook
    env:
      GEM_HOST_API_KEY: ${{ secrets.RUBYGEMS_API_KEY }}
      NODE_AUTH_TOKEN: ${{secrets.NPM_TOKEN}}
    steps:
      - name: Check for Semver label
        run: |
          LABELS=$(jq -r '.pull_request.labels[].name' "$GITHUB_EVENT_PATH")
          SEMVER_PATTERN="^(major|minor|patch)$"

          SEMVER_LABEL=$(echo "$LABELS" | grep -iE "$SEMVER_PATTERN" || true)

          if [ -z "$SEMVER_LABEL" ]; then
            echo "No valid Semver label found. Please add one of: major, minor, patch (case-insensitive)"
            exit 1
          else
            echo "Valid Semver label found: $SEMVER_LABEL"
            NORMALIZED_LABEL=$(echo "$SEMVER_LABEL" | tr '[:upper:]' '[:lower:]')
            echo "Normalized label: $NORMALIZED_LABEL"
          fi