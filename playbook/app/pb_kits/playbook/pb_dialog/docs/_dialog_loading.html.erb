<%= pb_rails("button", props: { text: "Open Dialog", data: {"open-dialog": "dialog-loading"} }) %>

<%= pb_rails("dialog", props: {
    id:"dialog-loading",
    size: "sm",
    title: "Loading Example",
    text: "Make a loading request?",
    cancel_button: "Cancel Button",
    cancel_button_id: "cancel-button-loading",
    confirm_button: "Okay",
    confirm_button_id: "confirm-button-loading",
    loading: true,
}) %>

<script>
    const loadingButton = document.querySelector('[data-disable-with="Loading"]');
    if (loadingButton) {
        loadingButton.addEventListener("click", function() {
        const okayLoadingButton = document.querySelector('[data-disable-with="Loading"]');
        const cancelButton = document.querySelector('[data-disable-cancel-with="Loading"]');
        let currentClass = okayLoadingButton.className;
        let cancelClass = cancelButton ? cancelButton.className : "";

        okayLoadingButton.disabled = true;
        okayLoadingButton.classList.add("pb_button_loading");
        okayLoadingButton.classList.remove("pb_button_enabled");
        okayLoadingButton.classList.add("pb_button_disabled");

        if (cancelButton) {
            cancelButton.disabled = true;
            cancelButton.classList.remove("pb_button_enabled");
            cancelButton.classList.add("pb_button_disabled");
        }

        setTimeout(function() {
            okayLoadingButton.disabled = false;
            okayLoadingButton.classList.remove("pb_button_loading");
            okayLoadingButton.classList.remove("pb_button_disabled");
            okayLoadingButton.classList.add("pb_button_enabled");

            if (cancelButton) {
            cancelButton.disabled = false;
            cancelButton.classList.remove("pb_button_disabled");
            cancelButton.classList.add("pb_button_enabled");
            }
        }, 5000);

        });
  }
</script>
