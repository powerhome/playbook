<%= pb_rails("rich_text_editor", props: { 
  id: "content-preview-editor",
  margin_bottom: "md",
  value: "Add text here, format it, and press \"Preview Output\" to see what your stylized output will look like on the page."
}) %>

<%= pb_rails("button", props: { id: "preview-button", text: "Preview Output", variant: "secondary" }) %>

<div id="card-obfuscation" style="display:none">
  <%= pb_rails("card", props: { margin_top: "md", max_width: "md", padding: "sm" }) do %>
   <div id="content-preview" class="tiptap-content">
   </div>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    function handleButtonClick() {
      // Find the specific TipTap editor container by ID
      const editorContainer = [...document.querySelectorAll('[data-pb-react-props]')]
        .find(element => element.getAttribute('data-pb-react-props')?.includes('"id":"content-preview-editor"'))

      if (!editorContainer) {
        console.log('Editor container not found')
        return
      }

      // Find the TipTap editor content
      const tiptapEditor = editorContainer.querySelector('.ProseMirror')
      const previewArea = document.getElementById('content-preview')
      const cardDiv = document.getElementById('card-obfuscation')

      if (tiptapEditor && previewArea && cardDiv) {
        // Get the HTML content from the TipTap editor
        const editorContent = tiptapEditor.innerHTML || ''
        previewArea.innerHTML = editorContent 
        cardDiv.style.display = 'block'
      }
    }

    document.getElementById('preview-button')?.addEventListener('click', handleButtonClick)
  })
</script>