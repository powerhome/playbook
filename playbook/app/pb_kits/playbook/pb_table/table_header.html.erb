<%= content_tag(:th,
    colspan: object.colspan,
    aria: object.aria,
    class: object.classname,
    data: object.data,
    id: "pb-th#{object.id}") do %>
  <% object.sort_menu.each do |item| %>
    <% if item[:active] == true %>
      <%= pb_rails("flex", props:{ align: object.align_content }) do %>
        <%= content.presence || content_tag(:span, item[:item], class: "pb_th_active") %>
        <span class="pb_th_active">
          <%= pb_rails("icon", props: { icon: object.sort_icon(item[:direction]),
                                        fixed_width: true,
                                        classname: "pb_th_active",
                                        padding_left: "xs" }) %>
        </span>
      <% end %>
    <% end %>
  <% end %>
  <% if object.sort_menu.all? { |item| item[:active] == false } %>
    <%= pb_rails("flex", props:{ align: object.align_content }) do %>
      <%= content.presence || object.text %>
      <%= pb_rails("icon", props: { icon: "arrow-up-arrow-down",
                                    fixed_width: true,
                                    padding_left: "xs" }) %>
    <% end %>
  <% else %>
    <%= content.presence || object.text %>
  <% end %>
  <% if object.sort_menu != [{}] && object.colspan > 1 %>
    <%= pb_rails("popover", props: { classname: "pb_filter_sort_menu",
                                    close_on_click: "outside",
                                    trigger_element_id: "pb-th#{object.id}",
                                    tooltip_id: "sort-filter-btn-tooltip#{object.id}",
                                    position: object.placement ,
                                    padding: 'none'}) do %>
      <%= pb_rails("list") do %>
        <% object.sort_menu.each do |item| %>
          <%= pb_rails("list/item") do %>
            <%= pb_rails("button", props: { variant: "link" ,
                                            classname: "p-0",
                                            text: item[:item],
                                            link: item[:link],
                                            icon: sort_icon(item[:direction]),
                                            icon_right: true }) %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
<% if object.sort_menu != [{}] && object.colspan == 1 %>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var thId = `<%= "#pb-th#{object.id}" %>`
      var firstLink = `<%= next_link %>`
      var thElement = document.querySelector(thId);

      thElement.addEventListener("click", function() {
        window.location.href = firstLink;
      });
    });
  </script>
<% end %>
